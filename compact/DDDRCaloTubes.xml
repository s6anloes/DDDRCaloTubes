<!-- ====================================================================== -->
<!--                                                                        -->
<!--    XML description of the complete SCEPCAL IDEA detector               -->
<!--    of the SCEPCAL IDEA collider detector design.                       -->
<!--                                                                        -->
<!--    Contained are the required                                          -->
<!--      ++ global constants used uniquely by this module                  -->
<!--      ++ visualization attributes                                       -->
<!--      ++ the definition of the readout structure and the                -->
<!--         readout segmentation (if necessary)                            -->
<!--      ++ the include statements for the sensitive detectors and         -->
<!--         the corresponding support structure(s)                         -->
<!--                                                                        -->
<!--                                                                        -->
<!--   @author  M.Frank                                                     -->
<!--   @date    14/11/2014                                                  -->
<!--                                                                        -->
<!-- ====================================================================== -->


<lccdd>

<!--
  <surfaces>
    <opticalsurface name="/world/DRCrystal#mirrorSurface" finish="polished" model="glisur" type="dielectric_metal">
    </opticalsurface>
    <opticalsurface name="/world/DRCrystal#tyvekSurface" finish="etchedtyvekair" model="LUT" type="dielectric_LUT" value="1.0">
    </opticalsurface>
    <opticalsurface name="/world/DRCrystal#dielectricSurface" finish="polished" model="glisur" type="dielectric_dielectric">
    </opticalsurface>
  </surfaces>



  <comment>EM Calorimeters</comment>
  <include ref="SCEPCAL_ECAL.xml"/> 


</lccdd>

<lccdd xmlns:compact="http://www.lcsim.org/schemas/compact/1.0"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xs:noNamespaceSchemaLocation="http://www.lcsim.org/schemas/compact/1.0/compact.xsd">-->


    <info name="DDDRCaloTubes"
        title="My first detector"
	    author="Andreas Loeschcke Centeno"
        status="development"
        version="1">
        <comment>My first detector</comment>
    </info>

    <!-- Constants, Readout, VIS goes here -->
    <includes>
        <gdmlFile  ref="elements.xml"/>
        <gdmlFile  ref="materials.xml"/>
    </includes> 

    <include ref="${DD4hepINSTALL}/DDDetectors/compact/detector_types.xml"/>
    
    <define>
        <constant name="world_side" value="600.*m"/>
        <constant name="world_x" value="world_side"/>
        <constant name="world_y" value="world_side"/>
        <constant name="world_z" value="world_side"/>

        <constant name="ECalBarrel_inner_radius" value="2150*mm"/>
        <constant name="ECalBarrel_outer_radius" value="2352*mm"/>
        <constant name="ECalBarrel_half_length" value="2210*mm"/>

        <constant name="TubeInnerRadius" value="0.5*mm" />
        <constant name="TubeOuterRadius" value="1.0*mm" />
        <constant name="TubeThickness"   value="TubeOuterRadius-TubeInnerRadius"/>
        <constant name="TowerHalfLength" value="50*cm"  />

        <constant name="NumRows" value="20" />
        <constant name="NumCols" value="16" />
    </define>

    
    <materials>

        <material name="Vacuum">
            <D type="density" unit="g/cm3" value="0.0000000001" />
            <fraction n="0.754" ref="N"/>
            <fraction n="0.234" ref="O"/>
            <fraction n="0.012" ref="Ar"/>
        </material>


        <material name="Air">
            <D type="density" unit="g/cm3" value="0.0012"/>
            <fraction n="0.754" ref="N"/>
            <fraction n="0.234" ref="O"/>
            <fraction n="0.012" ref="Ar"/>
            <property name="RINDEX"        ref="RINDEX__Air"/>
        </material>

        <material name="Brass">
            <D type="density" unit="g/cm3" value="8.44" />
            <fraction n="0.7" ref="Cu" />
            <fraction n="0.3" ref="Zn" />
        </material>

        <material name="PMMA" >
            <D type="density" unit="g/cm3" value="1.19" />
            <composite n="5" ref="C" />
            <composite n="2" ref="O" />
            <composite n="8" ref="H" />
        </material>

    </materials>

    <detectors>
        <detector 
            name="DDDRCaloTubes"
            type="DDDRCaloTubes"
            id="1234"
            readout="MyReadout"
            vis="MyVis" >

            <type_flags type=" DetType_CALORIMETER + DetType_ELECTROMAGNETIC + DetType_BARREL"/>

            <dimensions
                zmax="TowerHalfLength"
                rmin="TubeInnerRadius"
                rmax="TubeOuterRadius"/>

            <tube number="NumRows" count="NumCols">
                <capillary  material="Brass"       inner_r="TubeInnerRadius" outer_r="TubeOuterRadius" sensitive="false" vis="capillary_vis"  />
                <scin_fibre material="Polystyrene" inner_r="0.0*mm"          outer_r="TubeInnerRadius" sensitive="true"  vis="scin_fibre_vis" />
                <cher_fibre material="PMMA"        inner_r="0.0*mm"          outer_r="TubeInnerRadius" sensitive="true"  vis="cher_fibre_vis" />
            </tube>

            <layer repeat="1" vis="MyVis">
                <slice material="Polystyrene" thickness="TubeInnerRadius" />
                <slice material="Brass"       thickness="TubeThickness"   />
            </layer>

        </detector>
    </detectors>

    <define>
        <constant name="ECal_cell_size" value="5.1*mm"/>
    </define>

    <readouts>
        <readout name="MyReadout">
            <segmentation type="DRCaloTubeGrid" 
                grid_size="2*mm" />
            <id>system:5,side:2,module:9,stave:1,layer:9,fibre:1,cherenkov:1,q:32:-16,r:-16</id>
        </readout>
    </readouts>

    <display>
        <vis name="MyVis" 
            alpha="0.1"
            r="0.1" g=".5" b=".5"
            showDaughters="true"
            visible="false"/>

        <vis name="capillary_vis"
            alpha="1.0"
            r="0.855" g="0.647" b="0.125"
            showDaughters="true"
            visible="true" />

        <vis name="scin_fibre_vis" 
            alpha="1.0"
            r="1.000" g="0.388" b="0.278"
            showDaughters="true"
            visible="true" />

        <vis name="cher_fibre_vis" 
            alpha="1.0"
            r="0.392" g="0.584" b="0.929"
            showDaughters="true"
            visible="true" />

    </display>

    <limits>
        <limitset name="cal_limits">
            <limit name="step_length_max" particles="*" value="100.0" unit="mm" />
        </limitset>
    </limits>

</lccdd>